{% extends "base.html" %}
{% block title %}WPV â€” Upload: {{ game.name }}{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Upload Clips: {{ game.name }}</h1>
  <a href="/game/{{ game.game_id }}/masks" class="btn btn-primary">Next: Set Masks</a>
</div>

<div class="upload-grid" id="upload-grid">
  {% for clip in clips %}
  <div class="upload-card" data-clip-index="{{ clip.clip_index }}" id="card-{{ clip.clip_index }}">
    <h3>Clip {{ clip.clip_index + 1 }}</h3>
    {% if clip.uploaded %}
    <div class="upload-done">
      <span class="checkmark">&#10003;</span>
      <span class="filename">{{ clip.filename }}</span>
    </div>
    {% else %}
    <div class="drop-zone" id="drop-{{ clip.clip_index }}">
      <p>Drag & drop video here</p>
      <p class="text-muted">or</p>
      <input type="file" accept="video/*" class="file-input" id="file-{{ clip.clip_index }}"
             onchange="handleFileSelect(this, {{ clip.clip_index }})">
      <label for="file-{{ clip.clip_index }}" class="btn btn-sm">Choose File</label>
    </div>
    <div class="upload-progress" id="progress-{{ clip.clip_index }}" style="display:none">
      <div class="progress-bar-lg">
        <div class="progress-fill-lg" id="fill-{{ clip.clip_index }}"></div>
      </div>
      <span class="progress-text" id="ptext-{{ clip.clip_index }}">0%</span>
    </div>
    <div class="server-path-section">
      <span class="text-muted">or use server path:</span>
      <div class="server-path-row">
        <input type="text" class="form-input form-input-sm" id="path-{{ clip.clip_index }}"
               placeholder="/data/raw/video.mp4">
        <button class="btn btn-sm" onclick="setServerPath('{{ game.game_id }}', {{ clip.clip_index }})">Set</button>
      </div>
    </div>
    {% endif %}
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script>
var GAME_ID = '{{ game.game_id }}';
var CHUNK_SIZE = {{ config.web_upload_chunk_size_mb if config is defined else 10 }} * 1024 * 1024;
</script>
<script src="{{ url_for('static', filename='upload.js') }}"></script>
{% endblock %}
